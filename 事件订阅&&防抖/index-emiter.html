<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        class Event {
            constructor() {
                this.handlers = {}
            }

            on(eventName, cb) {
                const eventCallbackStack = this._getHandler(eventName).callbackStack
                eventCallbackStack.push(cb)
            }

            emit(eventName, ...args) {
                if (this.handlers[eventName]) {
                    this.handlers[eventName].callbackStack.forEach(cb => {
                        // 修正this指向
                        cb.call(cb, ...args)
                    })
                    // 移除once事件
                    if (this.handlers[eventName].isOnce) {
                        this.off(eventName)
                    }
                }
            }

            off(eventName) {
                this.handlers[eventName] && delete this.handlers[eventName]
            }

            once(eventName, cb) {
                const eventCallbackStack = this._getHandler(eventName, true).callbackStack
                eventCallbackStack.push(cb)
            }

            /**
             * 根据事件名获取事件对象
             * @param eventName
             * @param isOnce  // 是否为once事件
             */
            _getHandler(eventName, isOnce = false) {
                if (!this.handlers[eventName]) {
                    this.handlers[eventName] = {
                        isOnce,
                        callbackStack: [],
                    }
                }
                return this.handlers[eventName]
            }
        }
        const event = new Event()
        console.log('注册listen事件')
        event.on('listen', debounce(configView, 350))

        function configView(config){
            console.log("configView",config);
        }
        function debounce(fn, wait) {
            var timer = null;
            return function () {
                if (timer !== null) {
                    clearTimeout(timer);
                }
                timer = setTimeout(fn, wait);
            }
        }
        // console.log('触发listen事件')
        // event.emit('listen', 1, 2)
        // console.log('注销listen事件')
        // event.off('listen')
        // console.log('再次触发listen事件')
        // event.emit('listen', 1, 2)
    </script>


</body>

</html>